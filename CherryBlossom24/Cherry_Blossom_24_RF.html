<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Luna Frauhammer">
<meta name="dcterms.date" content="2024-02-23">

<title>Cherry Blossom Prediction Contest 2024</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Cherry_Blossom_24_RF_files/libs/clipboard/clipboard.min.js"></script>
<script src="Cherry_Blossom_24_RF_files/libs/quarto-html/quarto.js"></script>
<script src="Cherry_Blossom_24_RF_files/libs/quarto-html/popper.min.js"></script>
<script src="Cherry_Blossom_24_RF_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Cherry_Blossom_24_RF_files/libs/quarto-html/anchor.min.js"></script>
<link href="Cherry_Blossom_24_RF_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Cherry_Blossom_24_RF_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Cherry_Blossom_24_RF_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Cherry_Blossom_24_RF_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Cherry_Blossom_24_RF_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cherry Blossom Prediction Contest 2024</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Luna Frauhammer </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 23, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Goal of this contest is to predict the 2024 cherry tree bloom dates at five different locations around the world. I will predict this year’s bloom dates using four different predictors in a linear regression: <br></p>
<ol type="1">
<li>Past bloom dates starting in 1954 <br></li>
<li>Each year’s estimated dormacy release date (DRD; explanation see below) <br></li>
<li>The modeled temperature at the DRD <br></li>
<li>The mean temperature in January <br></li>
</ol>
<p>For Vancouver and New York City, I have to proceed differently, because there exist no (or only few) records of past bloom dates. I thus use the USA-NPN dataset (containing records of bloom dates in different years and different cities in the US) to model past Vancouver and New York City bloom dates. I then use this modeled data to predict future bloom dates. <br></p>
</section>
<section id="set-up-r-and-read-in-data" class="level1">
<h1>Set up R and read in data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"/Users/lunafrauhammer/Library/CloudStorage/OneDrive-UniversitaetDuisburg-Essen/Sonstiges/CherryBlossom/CherryBlossom24"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set working directory to folder CherryBlossom24 to run this code. </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Metrics)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sysfonts)<span class="co">#</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>doy_to_date <span class="ot">&lt;-</span> <span class="cf">function</span> (year, doy) {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strptime</span>(<span class="fu">paste</span>(year, doy, <span class="at">sep =</span> <span class="st">'-'</span>), <span class="st">'%Y-%j'</span>) <span class="sc">%&gt;%</span> <span class="co"># create date object</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">strftime</span>(<span class="st">'%Y-%m-%d'</span>) <span class="co"># translate back to date string in ISO 8601 format</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>cherry1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/washingtondc.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/liestal.csv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/kyoto.csv"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/vancouver.csv"</span>))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>cherry1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(cherry1, year <span class="sc">&gt;=</span> <span class="dv">1954</span>) </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># I will only use data from 1954 onwards. </span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Because there are only two dates for Vancouver, I will remove this for now: </span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>cherry <span class="ot">&lt;-</span> <span class="fu">subset</span>(cherry1, location <span class="sc">!=</span> <span class="st">"vancouver"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's take a look at the historic bloom dates: </span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>city_Colors<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">kyoto =</span> <span class="st">"lightpink1"</span>, <span class="at">liestal =</span> <span class="st">"lightskyblue"</span>, </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">washingtondc =</span> <span class="st">"palegreen3"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cherry, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bloom_doy)) <span class="sc">+</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">label =</span> <span class="st">"\u273F"</span>, <span class="fu">aes</span>(<span class="at">color =</span> location),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span><span class="dv">4</span>, <span class="at">family =</span> <span class="st">"Arial Unicode MS"</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>   <span class="co">#  scale_color_discrete(name = "location") +</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Full Blossom Day of the Year"</span>) <span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">color =</span> location), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>   <span class="co"># geom_smooth(method = "lm", fullrange = TRUE, aes(fill = location), alpha = 0.2,)</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values=</span>city_Colors, <span class="at">name =</span> <span class="st">"Location"</span>, </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Kyoto"</span>, <span class="st">"Liestal-Weideli"</span>, <span class="st">"Washington, D.C."</span>)) <span class="sc">+</span> </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Historic Bloom Dates"</span>) <span class="sc">+</span> </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylim</span>(<span class="dv">70</span>, <span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (`geom_text()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("historicDates.png", p1)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get the weather information: </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnoaa) </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># stations &lt;- ghcnd_stations()</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>weatherWash <span class="ot">&lt;-</span> <span class="fu">ghcnd_search</span>(<span class="st">"USC00186350"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>weatherLies <span class="ot">&lt;-</span> <span class="fu">ghcnd_search</span>(<span class="st">"GME00127786"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>weatherKyot <span class="ot">&lt;-</span> <span class="fu">ghcnd_search</span>(<span class="st">"JA000047759"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>weatherVan <span class="ot">&lt;-</span> <span class="fu">ghcnd_search</span>(<span class="st">"CA001108395"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>weatherNY <span class="ot">&lt;-</span> <span class="fu">ghcnd_search</span>(<span class="st">"USW00094728"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> <span class="fu">rbind</span>(weatherWash<span class="sc">$</span>tmax, weatherLies<span class="sc">$</span>tmax, weatherKyot<span class="sc">$</span>tmax, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                 weatherVan<span class="sc">$</span>tmax, weatherNY<span class="sc">$</span>tmax)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># I am using the maximum daily temperatures. </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data set: </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>weather[weather<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"USC00186350"</span>, ]<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="st">"Washington"</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>weather[weather<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"GME00127786"</span>, ]<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="st">"Liestal"</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>weather[weather<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"JA000047759"</span>, ]<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="st">"Kyoto"</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>weather[weather<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"CA001108395"</span>, ]<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="st">"Vancouver"</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>weather[weather<span class="sc">$</span>id <span class="sc">==</span> <span class="st">"USW00094728"</span>, ]<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="st">"NewYork"</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather[weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Washington"</span>, ]<span class="sc">$</span>date) <span class="co"># data from 10/01/1948 - 12/31/2023</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather[weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Liestal"</span>, ]<span class="sc">$</span>date) <span class="co"># data from 10/01/1953 - 12/31/2023</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather[weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Kyoto"</span>, ]<span class="sc">$</span>date) <span class="co"># data from 01/01/1951 - 02/29/2024</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather[weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Vancouver"</span>, ]<span class="sc">$</span>date) <span class="co"># data from 01/01/1957 - 02/29/2024</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(weather[weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"NewYork"</span>, ]<span class="sc">$</span>date) <span class="co"># data from 01/01/1869 - 02/29/2024</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(weather<span class="sc">$</span>date, <span class="st">"%Y/%m/%d"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">year</span>(weather<span class="sc">$</span>date)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>date.within <span class="ot">&lt;-</span> <span class="fu">format</span>(weather<span class="sc">$</span>date, <span class="at">format=</span><span class="st">"%m-%d"</span>) </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">yday</span>(weather<span class="sc">$</span>date) <span class="co"># day of the year </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-1-predict-2023-bloom-dates-for-washington-liestal-and-kyoto" class="level1">
<h1>Step 1: Predict 2023 bloom dates for Washington, Liestal, and Kyoto</h1>
<p>In the first step, I only predict the 2023 bloom dates for those cities for which I have historic bloom data, i.e., Washington, Liestal, and Kyoto. Like stated above, I will use the historic bloom dates as well as each year’s DRD, modeled DRD temperature and mean January temperature as predictors.</p>
<section id="calculate-historic-dormacy-release-dates" class="level2">
<h2 class="anchored" data-anchor-id="calculate-historic-dormacy-release-dates">Calculate Historic Dormacy Release Dates</h2>
<p>The dormacy release date (DRD) is the day in late Winter / early Spring when the temperature trend reverses from going down to going up again. Since cherry blossoms need both periods of decreasing / colder and increasing / warmer temperatures to bloom, the DRD can be an important predictor of the cherry blossom bloom date (Chung et al., 2011). <br></p>
<p>In order to get each year’s DRD, I fit a quadratic regression on the temperatures between October 1st and March 31st. I then use the minimum of this function as estimation of the DRD.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I first need a new yearly organizing variable that changes on October 1st </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of on January 1st:  </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>yearWinter <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(weather)){</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  year.margin <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(weather<span class="sc">$</span>year[y], <span class="st">"10-01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  weather<span class="sc">$</span>yearWinter[y] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(weather<span class="sc">$</span>date[y] <span class="sc">&gt;=</span> year.margin, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                  weather<span class="sc">$</span>year[y] <span class="sc">+</span> <span class="dv">1</span>, weather<span class="sc">$</span>year[y])</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># I then exclude all data points that lie in between June and October because </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># I don't need them</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>weather <span class="ot">&lt;-</span> weather[<span class="sc">!</span>(<span class="fu">month</span>(weather<span class="sc">$</span>date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">9</span>)), ]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># I now add a new DOY variable with negative numbers from October 1st to </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># December 31st</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>weather<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="fu">unique</span>(weather<span class="sc">$</span>yearWinter)){</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Washington"</span>, ]<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="at">by =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Washington"</span>, ]))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Liestal"</span>, ]<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="at">by =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Liestal"</span>, ]))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Kyoto"</span>, ]<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="at">by =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Kyoto"</span>, ]))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Vancouver"</span>, ]<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="at">by =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"Vancouver"</span>, ]))</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"NewYork"</span>, ]<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="at">by =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fu">nrow</span>(weather[weather<span class="sc">$</span>yearWinter <span class="sc">==</span> y <span class="sc">&amp;</span> </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    weather<span class="sc">$</span>location <span class="sc">==</span> <span class="st">"NewYork"</span>, ]))</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># I now estimate the DRDs. </span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Illustration for the year 2022 in Liestal: </span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>temp23 <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Liestal"</span> <span class="sc">&amp;</span> yearWinter <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>fit23 <span class="ot">&lt;-</span> <span class="fu">lm</span>(tmax <span class="sc">~</span> doy.n <span class="sc">+</span> <span class="fu">I</span>(doy.n<span class="sc">^</span><span class="dv">2</span>), temp23)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>coefs23 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit23)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>doy.p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span> <span class="fu">nrow</span>(temp23) <span class="sc">-</span> <span class="dv">92</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>fit.p <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit23, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">doy.n =</span> doy.p))</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>fun23 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  coefs23[<span class="dv">1</span>] <span class="sc">+</span> coefs23[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span> coefs23[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>DRD23 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun23, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>])</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>temp_pred23 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun23, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">2</span>])</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(temp23, <span class="fu">plot</span>(tmax <span class="sc">~</span> doy.n, <span class="at">ylab =</span> <span class="st">"Maximum Temperature (1/10 °Celsius)"</span>, </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab =</span> <span class="st">"Day of the Year"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, <span class="at">bty =</span> <span class="st">"L"</span>, </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">main =</span> <span class="st">"Illustration: 2023 DRD in Liestal"</span>))</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.p <span class="sc">~</span> doy.p, <span class="at">col =</span> <span class="st">"forestgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> DRD23, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(DRD23,  <span class="dv">220</span>, <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="fu">bold</span>(<span class="st">"Dormancy Release Date"</span>))), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> temp_pred23, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(DRD23 <span class="sc">+</span><span class="dv">60</span>,  temp_pred23 <span class="sc">-</span> <span class="dv">10</span>, <span class="fu">substitute</span>(<span class="fu">paste</span>(<span class="fu">bold</span>(<span class="st">"Modeled DRD Temperature"</span>))), <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, I model the DRD for each year in the temperature data set for each of the three locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(l <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Washington"</span>, <span class="st">"Liestal"</span>, <span class="st">"Kyoto"</span>, <span class="st">"Vancouver"</span>, <span class="st">"NewYork"</span>)){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  DRD <span class="ot">&lt;-</span> year <span class="ot">&lt;-</span> DRD.t.pred <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  weather_Loc <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> l)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(weather_Loc<span class="sc">$</span>yearWinter))<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    year.y <span class="ot">&lt;-</span> <span class="fu">unique</span>(weather_Loc<span class="sc">$</span>yearWinter)[y]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    temp.year <span class="ot">&lt;-</span> weather_Loc[weather_Loc<span class="sc">$</span>yearWinter <span class="sc">==</span> year.y, ]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(temp.year) <span class="sc">&gt;</span> <span class="dv">200</span>){ <span class="co"># not all years are complete</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(tmax <span class="sc">~</span> doy.n <span class="sc">+</span> <span class="fu">I</span>(doy.n<span class="sc">^</span><span class="dv">2</span>), temp.year))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        coefs[<span class="dv">1</span>] <span class="sc">+</span> coefs[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span> coefs[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      DRD[y] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun, <span class="at">interval =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="dv">200</span>), </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>])</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      year[y] <span class="ot">&lt;-</span> <span class="fu">unique</span>(weather_Loc<span class="sc">$</span>yearWinter)[y]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      DRD.t.pred[y] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun, <span class="at">interval =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="dv">200</span>), </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">2</span>]) <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">"DRD_"</span>, l, <span class="at">sep =</span> <span class="st">""</span>), DRD)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">"DRD.t.pred_"</span>, l, <span class="at">sep =</span> <span class="st">""</span>), DRD.t.pred)</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">"year_"</span>, l, <span class="at">sep =</span> <span class="st">""</span>), year)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>temp_Wash <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> year_Washington, <span class="at">DRD =</span> DRD_Washington, </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">t.pred =</span> DRD.t.pred_Washington)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot.stats(temp_Wash$DRD)$out</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>temp_Lies <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> year_Liestal, <span class="at">DRD =</span> DRD_Liestal, </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                        <span class="at">t.pred =</span> DRD.t.pred_Liestal)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot.stats(temp_Wash$DRD)$out</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>temp_Kyot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> year_Kyoto, <span class="at">DRD =</span> DRD_Kyoto, </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                        <span class="at">t.pred =</span> DRD.t.pred_Kyoto)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot.stats(temp_Kyot$DRD)$out</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>temp_Vanc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> year_Vancouver, <span class="at">DRD =</span> DRD_Vancouver, </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                        <span class="at">t.pred =</span> DRD.t.pred_Vancouver)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># boxplot.stats(temp_Vanc$DRD)$out</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>temp_NY <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> year_NewYork, <span class="at">DRD =</span> DRD_NewYork, </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">t.pred =</span> DRD.t.pred_NewYork)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_Wash, temp_Lies, temp_Kyot, temp_Vanc, temp_NY)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Washington"</span>, <span class="st">"Liestal"</span>, <span class="st">"Kyoto"</span>, <span class="st">"Vancouver"</span>, <span class="st">"NewYork"</span>), </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="fu">nrow</span>(temp_Wash), <span class="fu">nrow</span>(temp_Lies), <span class="fu">nrow</span>(temp_Kyot), </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">nrow</span>(temp_Vanc), <span class="fu">nrow</span>(temp_NY)))</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> DRD)) <span class="sc">+</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">1950</span>, <span class="dv">2020</span>) <span class="sc">+</span> </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>location) <span class="sc">+</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Estimated DRD"</span>) <span class="sc">+</span> </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Historic DRDs"</span>) <span class="sc">+</span> </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> t.pred)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>location) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">1950</span>, <span class="dv">2020</span>) <span class="sc">+</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Modeled temperature at DRD (°C)"</span>) <span class="sc">+</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Historic DRD Temperatures"</span>) <span class="sc">+</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="calculate-mean-january-temperature" class="level2">
<h2 class="anchored" data-anchor-id="calculate-mean-january-temperature">Calculate Mean January Temperature</h2>
<p>As an additional predictor, I will use each year’s mean temperature in January. In the following steps, I get this data from the historic weather data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Washington, D.C. </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mean.jan_Wash <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>year_Wash <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>weather_Wash <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Washington"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>weather_Wash_jan <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather_Wash, <span class="fu">month</span>(date) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(weather_Wash_jan<span class="sc">$</span>yearWinter))<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">unique</span>(weather_Wash_jan<span class="sc">$</span>yearWinter)[y]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  mean.jan_Wash[y] <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_Wash_jan[weather_Wash_jan<span class="sc">$</span>yearWinter <span class="sc">==</span> year,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                            ]<span class="sc">$</span>tmax,<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  year_Wash[y] <span class="ot">&lt;-</span> year</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>jan_Wash <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean.jan =</span> mean.jan_Wash, <span class="at">year =</span> year_Wash)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Liestal:</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>mean.jan_Lies <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>year_Lies <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>weather_Lies <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Liestal"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>weather_Lies_jan <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather_Lies, <span class="fu">month</span>(date) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(weather_Lies_jan<span class="sc">$</span>yearWinter))<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">unique</span>(weather_Lies_jan<span class="sc">$</span>yearWinter)[y]</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  mean.jan_Lies[y] <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_Lies_jan[weather_Lies_jan<span class="sc">$</span>yearWinter <span class="sc">==</span> year,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                                            ]<span class="sc">$</span>tmax,<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  year_Lies[y] <span class="ot">&lt;-</span> year</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>jan_Lies <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean.jan =</span> mean.jan_Lies, <span class="at">year =</span> year_Lies)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Kyoto: </span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>mean.jan_kyot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>year_kyot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>weather_kyot <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Kyoto"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>weather_kyot_jan <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather_kyot, <span class="fu">month</span>(date) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(weather_kyot_jan<span class="sc">$</span>yearWinter))<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">unique</span>(weather_kyot_jan<span class="sc">$</span>yearWinter)[y]</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  mean.jan_kyot[y] <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_kyot_jan[weather_kyot_jan<span class="sc">$</span>yearWinter <span class="sc">==</span> year,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>                                            ]<span class="sc">$</span>tmax,<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  year_kyot[y] <span class="ot">&lt;-</span> year</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>jan_Kyot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean.jan =</span> mean.jan_kyot, <span class="at">year =</span> year_kyot)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Vancouver: </span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>mean.jan_Vanc <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>year_Vanc <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>weather_Vanc <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Vancouver"</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>weather_Vanc_jan <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather_Vanc, <span class="fu">month</span>(date) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(weather_Vanc_jan<span class="sc">$</span>yearWinter))<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">unique</span>(weather_Vanc_jan<span class="sc">$</span>yearWinter)[y]</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  mean.jan_Vanc[y] <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_Vanc_jan[weather_Vanc_jan<span class="sc">$</span>yearWinter <span class="sc">==</span> year,</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                                            ]<span class="sc">$</span>tmax,<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  year_Vanc[y] <span class="ot">&lt;-</span> year</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>jan_Vanc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean.jan =</span> mean.jan_Vanc, <span class="at">year =</span> year_Vanc)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="do">### New York: </span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>mean.jan_NY <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>year_NY <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>weather_NY <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"NewYork"</span>)</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>weather_NY_jan <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather_NY, <span class="fu">month</span>(date) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(y <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">unique</span>(weather_NY_jan<span class="sc">$</span>yearWinter))<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">unique</span>(weather_NY_jan<span class="sc">$</span>yearWinter)[y]</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  mean.jan_NY[y] <span class="ot">&lt;-</span> <span class="fu">mean</span>(weather_NY_jan[weather_NY_jan<span class="sc">$</span>yearWinter <span class="sc">==</span> year,</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>                                            ]<span class="sc">$</span>tmax,<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  year_NY[y] <span class="ot">&lt;-</span> year</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>jan_NY <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mean.jan =</span> mean.jan_NY, <span class="at">year =</span> year_NY)</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>temp_Wash <span class="ot">&lt;-</span> <span class="fu">merge</span>(temp_Wash, jan_Wash, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>temp_Lies <span class="ot">&lt;-</span> <span class="fu">merge</span>(temp_Lies, jan_Lies, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>temp_Kyot <span class="ot">&lt;-</span> <span class="fu">merge</span>(temp_Kyot, jan_Kyot, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>temp_Vanc <span class="ot">&lt;-</span> <span class="fu">merge</span>(temp_Vanc, jan_Vanc, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>temp_NY <span class="ot">&lt;-</span> <span class="fu">merge</span>(temp_NY, jan_NY, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(temp_Wash, temp_Lies, temp_Kyot, temp_Vanc, temp_NY)</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Washington"</span>, <span class="st">"Liestal"</span>, <span class="st">"Kyoto"</span>, <span class="st">"Vancouver"</span>, <span class="st">"NewYork"</span>), </span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="fu">nrow</span>(temp_Wash), <span class="fu">nrow</span>(temp_Lies), <span class="fu">nrow</span>(temp_Kyot), </span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">nrow</span>(temp_Vanc), <span class="fu">nrow</span>(temp_NY)))</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(temp, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean.jan)) <span class="sc">+</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>location) <span class="sc">+</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>) <span class="sc">+</span> </span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">1950</span>, <span class="dv">2020</span>) <span class="sc">+</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mean January temperature (°C)"</span>) <span class="sc">+</span> </span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Historic Mean January Temperatures"</span>) <span class="sc">+</span> </span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="estimate-2024-drd" class="level2">
<h2 class="anchored" data-anchor-id="estimate-2024-drd">Estimate 2024 DRD</h2>
<p>Before I can estimate the 2024 bloom dates, I need to estimate this year’s DRD. However, the ghcnd weather data ends in 2023, so I looked for more current temperature data online and retrieved free temperature data from https://www.visualcrossing.com. These data sets include the weather data between 10/01/2023 and 02/29/2024 (forecast) for each city. <br></p>
<section id="washington" class="level3">
<h3 class="anchored" data-anchor-id="washington">1. Washington:</h3>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Wash_2024 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/washington dc 2023-10-01 to 2024-02-29.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether both data sources match: </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>wGHCN <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Washington"</span> <span class="sc">&amp;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                  date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>wVC <span class="ot">&lt;-</span> <span class="fu">subset</span>(Wash_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tempmax</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(wGHCN, wVC, <span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="co"># r = .83 so this seems okay!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8289739</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Wash_2024<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">as.Date</span>(Wash_2024<span class="sc">$</span>datetime))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Wash_2024<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span><span class="dv">60</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>Wash_2024<span class="sc">$</span>tmax <span class="ot">&lt;-</span> Wash_2024<span class="sc">$</span>tempmax</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the problem is that I have to little 2023 data to sensibly model the DRD. I will</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># thus use the last 10 years' mean temperature data between March and June to </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># improve the DRD prediction. However, these values will be weighted less strongly </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># than the actually observed temperature data. </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(<span class="fu">as.Date</span>(<span class="st">"2024-03-01"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 61</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(<span class="fu">as.Date</span>(<span class="st">"2024-05-31"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 152</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I get the 61th - 153rd days of the year; for leap years this is March 1st - June 1st </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for other years it is March 2nd - June 2nd. </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I now get the mean temperature of the last 10 years for all of these days: </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>mw_Wash <span class="ot">&lt;-</span> <span class="fu">subset</span>(<span class="fu">aggregate</span>(tmax <span class="sc">~</span> doy, <span class="fu">subset</span>(weather_Wash, year <span class="sc">&gt;=</span> <span class="dv">2013</span>), mean), </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                  doy <span class="sc">%in%</span> <span class="dv">61</span><span class="sc">:</span><span class="dv">152</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>mw_Wash<span class="sc">$</span>tmax <span class="ot">&lt;-</span> mw_Wash<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>w24_Wash <span class="ot">&lt;-</span> Wash_2024[, <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mw_Wash) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>w_Wash <span class="ot">&lt;-</span> <span class="fu">rbind</span>(w24_Wash, mw_Wash)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit quadratic regression with specified weights: </span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), <span class="fu">c</span>(<span class="dv">153</span>, <span class="dv">91</span>))</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>fit24_Wash <span class="ot">&lt;-</span> <span class="fu">lm</span>(tmax <span class="sc">~</span> doy.n <span class="sc">+</span> <span class="fu">I</span>(doy.n<span class="sc">^</span><span class="dv">2</span>), w_Wash, <span class="at">weights =</span> weights)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>coefs24_Wash <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit24_Wash)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>doy.p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span> <span class="dv">152</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>fit.p_Wash <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit24_Wash, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">doy.n =</span> doy.p))</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>fun24_Wash <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  coefs24_Wash[<span class="dv">1</span>] <span class="sc">+</span> coefs24_Wash[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span> coefs24_Wash[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>DRD24_Wash <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Wash, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>])</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>t.DRD24_Wash <span class="ot">&lt;-</span> w_Wash[w_Wash<span class="sc">$</span>doy.n <span class="sc">==</span> <span class="fu">round</span>(DRD24_Wash), ]<span class="sc">$</span>tmax</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>tpred24_Wash <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Wash, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">2</span>])</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Wash, doy.n <span class="sc">&lt;=</span> <span class="dv">60</span>), </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot</span>(tmax <span class="sc">~</span> doy.n, <span class="at">ylab =</span> <span class="st">"Maximum Temperature (°Celsius)"</span>, </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlab =</span> <span class="st">"Day of the Year"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="dv">150</span>), <span class="at">bty =</span> <span class="st">"L"</span>, </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">main =</span> <span class="st">"Predicted 2024 DRD: Washington, D.C."</span>))</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Wash, doy.n <span class="sc">&gt;</span> <span class="dv">60</span>), </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>     <span class="fu">points</span>(tmax <span class="sc">~</span> doy.n, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)))</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.p_Wash <span class="sc">~</span> doy.p, <span class="at">col =</span> <span class="st">"forestgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> DRD24_Wash, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(DRD24_Wash,  <span class="dv">20</span>, <span class="st">"Dormacy Release Date"</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>DRD_Wash <span class="ot">&lt;-</span> <span class="fu">c</span>(DRD_Washington, DRD24_Wash) </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>t.pred_Wash <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_Wash<span class="sc">$</span>t.pred, tpred24_Wash)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean January temperature</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>j24_Wash <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(Wash_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>) <span class="sc">&amp;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-31"</span>))<span class="sc">$</span>tempmax) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="liestal" class="level3">
<h3 class="anchored" data-anchor-id="liestal">2. Liestal:</h3>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Lies_2024 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/liestal 2023-10-01 to 2024-02-29.csv"</span>, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether both data sources match: </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>wGHCN <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Liestal"</span> <span class="sc">&amp;</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                  date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>wVC <span class="ot">&lt;-</span> <span class="fu">subset</span>(Lies_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tempmax</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(wGHCN, wVC) <span class="co"># very high correlation -&gt; looks good!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9899423</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>Lies_2024<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">as.Date</span>(Lies_2024<span class="sc">$</span>datetime))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>Lies_2024<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span><span class="dv">60</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>Lies_2024<span class="sc">$</span>tmax <span class="ot">&lt;-</span> Lies_2024<span class="sc">$</span>tempmax</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>mw_Lies <span class="ot">&lt;-</span> <span class="fu">subset</span>(<span class="fu">aggregate</span>(tmax <span class="sc">~</span> doy, <span class="fu">subset</span>(weather_Lies, year <span class="sc">&gt;=</span> <span class="dv">2013</span>), mean), </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                  doy <span class="sc">%in%</span> <span class="dv">61</span><span class="sc">:</span><span class="dv">152</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>mw_Lies<span class="sc">$</span>tmax <span class="ot">&lt;-</span> mw_Lies<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>w24_Lies <span class="ot">&lt;-</span> Lies_2024[, <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)]</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mw_Lies) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>w_Lies <span class="ot">&lt;-</span> <span class="fu">rbind</span>(w24_Lies, mw_Lies)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># fit quadratic regression with specified weights: </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), <span class="fu">c</span>(<span class="dv">153</span>, <span class="dv">91</span>))</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>fit24_Lies <span class="ot">&lt;-</span> <span class="fu">lm</span>(tmax <span class="sc">~</span> doy.n <span class="sc">+</span> <span class="fu">I</span>(doy.n<span class="sc">^</span><span class="dv">2</span>), w_Lies, <span class="at">weights =</span> weights)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>coefs24_Lies <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit24_Lies)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>doy.p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span> <span class="dv">153</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>fit.p_Lies <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit24_Lies, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">doy.n =</span> doy.p))</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>fun24_Lies <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  coefs24_Lies[<span class="dv">1</span>] <span class="sc">+</span> coefs24_Lies[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span> coefs24_Lies[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>DRD24_Lies <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Lies, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>])</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>t.DRD24_Lies <span class="ot">&lt;-</span> w_Lies[w_Lies<span class="sc">$</span>doy.n <span class="sc">==</span> <span class="fu">round</span>(DRD24_Lies), ]<span class="sc">$</span>tmax</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>tpred24_Lies <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Lies, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">2</span>])</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Lies, doy.n <span class="sc">&lt;=</span> <span class="dv">60</span>), </span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot</span>(tmax <span class="sc">~</span> doy.n, <span class="at">ylab =</span> <span class="st">"Maximum Temperature (°Celsius)"</span>, </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlab =</span> <span class="st">"Day of the Year"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="dv">150</span>), <span class="at">bty =</span> <span class="st">"L"</span>, </span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">main =</span> <span class="st">"Predicted 2023 DRD: Liestal"</span>))</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Lies, doy.n <span class="sc">&gt;</span> <span class="dv">60</span>), </span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>     <span class="fu">points</span>(tmax <span class="sc">~</span> doy.n, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)))</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.p_Lies <span class="sc">~</span> doy.p, <span class="at">col =</span> <span class="st">"forestgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> DRD24_Lies, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(DRD24_Lies,  <span class="dv">20</span>, <span class="st">"Dormacy Release Date"</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>DRD_Lies <span class="ot">&lt;-</span> <span class="fu">c</span>(DRD_Liestal, DRD24_Lies) </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>t.pred_Lies <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_Lies<span class="sc">$</span>t.pred, tpred24_Lies)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean January temperature: </span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>j24_Lies <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(Lies_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>) <span class="sc">&amp;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-31"</span>))<span class="sc">$</span>tempmax) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="kyoto" class="level3">
<h3 class="anchored" data-anchor-id="kyoto">3. Kyoto:</h3>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>Kyot_2024 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/kyoto 2023-10-01 to 2024-02-29.csv"</span>, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether both data sources match: </span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>wGHCN <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Kyoto"</span> <span class="sc">&amp;</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                  date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>wVC <span class="ot">&lt;-</span> <span class="fu">subset</span>(Kyot_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tempmax</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(wGHCN, wVC, <span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="co"># very high correlation -&gt; no problem!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9914435</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Kyot_2024<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">as.Date</span>(Kyot_2024<span class="sc">$</span>datetime))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Kyot_2024<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span><span class="dv">60</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>Kyot_2024<span class="sc">$</span>tmax <span class="ot">&lt;-</span> Kyot_2024<span class="sc">$</span>tempmax</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>weather_Kyot <span class="ot">&lt;-</span> weather_kyot</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>mw_Kyot <span class="ot">&lt;-</span> <span class="fu">subset</span>(<span class="fu">aggregate</span>(tmax <span class="sc">~</span> doy, <span class="fu">subset</span>(weather_Kyot, year <span class="sc">&gt;=</span> <span class="dv">2013</span>), mean), </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                  doy <span class="sc">%in%</span> <span class="dv">61</span><span class="sc">:</span><span class="dv">152</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>mw_Kyot<span class="sc">$</span>tmax <span class="ot">&lt;-</span> mw_Kyot<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>w24_Kyot <span class="ot">&lt;-</span> Kyot_2024[, <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mw_Kyot) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>w_Kyot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(w24_Kyot, mw_Kyot)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># fit quadratic regression with specified weights: </span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), <span class="fu">c</span>(<span class="dv">153</span>, <span class="dv">91</span>))</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>fit24_Kyot <span class="ot">&lt;-</span> <span class="fu">lm</span>(tmax <span class="sc">~</span> doy.n <span class="sc">+</span> <span class="fu">I</span>(doy.n<span class="sc">^</span><span class="dv">2</span>), w_Kyot, <span class="at">weights =</span> weights)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>coefs24_Kyot <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit24_Kyot)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>doy.p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span> <span class="dv">152</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>fit.p_Kyot <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit24_Kyot, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">doy.n =</span> doy.p))</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>fun24_Kyot <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  coefs24_Kyot[<span class="dv">1</span>] <span class="sc">+</span> coefs24_Kyot[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span> coefs24_Kyot[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>DRD24_Kyot <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Kyot, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>])</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>t.DRD24_Kyot <span class="ot">&lt;-</span> w_Kyot[w_Kyot<span class="sc">$</span>doy.n <span class="sc">==</span> <span class="fu">round</span>(DRD24_Kyot), ]<span class="sc">$</span>tmax</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>tpred24_Kyot <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Kyot, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">2</span>])</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Kyot, doy.n <span class="sc">&lt;=</span> <span class="dv">60</span>), </span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot</span>(tmax <span class="sc">~</span> doy.n, <span class="at">ylab =</span> <span class="st">"Maximum Temperature (°Celsius)"</span>, </span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlab =</span> <span class="st">"Day of the Year"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, </span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="dv">150</span>), <span class="at">bty =</span> <span class="st">"L"</span>, </span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">main =</span> <span class="st">"Predicted 2023 DRD: Kyoto"</span>))</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Kyot, doy.n <span class="sc">&gt;</span> <span class="dv">60</span>), </span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>     <span class="fu">points</span>(tmax <span class="sc">~</span> doy.n, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)))</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.p_Kyot <span class="sc">~</span> doy.p, <span class="at">col =</span> <span class="st">"forestgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> DRD24_Kyot, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(DRD24_Kyot,  <span class="dv">20</span>, <span class="st">"Dormacy Release Date"</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>DRD_Kyot <span class="ot">&lt;-</span> <span class="fu">c</span>(DRD_Kyoto, DRD24_Kyot) </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>t.pred_Kyot <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_Kyot<span class="sc">$</span>t.pred, tpred24_Kyot)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean January temperature</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2024: </span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>j24_Kyot <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(Kyot_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>) <span class="sc">&amp;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-31"</span>))<span class="sc">$</span>tempmax) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="prediction-washington-liestal-kyoto" class="level2">
<h2 class="anchored" data-anchor-id="prediction-washington-liestal-kyoto">Prediction: Washington, Liestal, Kyoto</h2>
<p>After modeling the DRDs, DRD temperatures, and calculating each year’s mean January temperature, I can now predict the 2024 bloom dates. I do this seperately for each city since I want to consider the goodness of fit indices for all cities.</p>
<section id="washington-1" class="level3">
<h3 class="anchored" data-anchor-id="washington-1">1. Washington</h3>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"LOOCV"</span>) <span class="co"># set caret train function to leave one out</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>cherry_Wash <span class="ot">&lt;-</span> <span class="fu">subset</span>(cherry, location <span class="sc">==</span> <span class="st">"washingtondc"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># now use data from temperature data set: temp_Lies</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>dat_Wash <span class="ot">&lt;-</span> <span class="fu">merge</span>(cherry_Wash, temp_Wash, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="do">### Different Models</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>mYearW <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year, <span class="at">data =</span> dat_Wash,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># mYearW</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mYearW) # R^2 = 0.23</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>mDRDW <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> DRD, <span class="at">data =</span> dat_Wash, </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mDRDW) # R^2 = 0.13</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>mtpredW <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> t.pred, <span class="at">data =</span> dat_Wash, </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mtpredW) # R^2 = 0.25</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>mjanW <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> mean.jan, <span class="at">data =</span> dat_Wash, </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mjanW) # R^2 = 0.02</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>mAllW <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">+</span> t.pred <span class="sc">+</span> mean.jan, <span class="at">data =</span> dat_Wash, </span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mAllW) <span class="co"># R^2 = 0.59 -&gt; I will take this model!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.3155 -3.0399 -0.1244  3.0013 10.1582 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 385.31877   57.72019   6.676 8.34e-09 ***
year         -0.14336    0.02929  -4.894 7.57e-06 ***
DRD           0.50699    0.12226   4.147 0.000106 ***
t.pred       -3.00484    0.53672  -5.598 5.46e-07 ***
mean.jan      0.99505    0.34480   2.886 0.005390 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.722 on 61 degrees of freedom
Multiple R-squared:  0.5857,    Adjusted R-squared:  0.5585 
F-statistic: 21.56 on 4 and 61 DF,  p-value: 4.011e-11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check cross validation results (using leave-one-out method): </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>mAllW</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

66 samples
 4 predictor

No pre-processing
Resampling: Leave-One-Out Cross-Validation 
Summary of sample sizes: 65, 65, 65, 65, 65, 65, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  4.906488  0.5168813  4.131986

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 4.91, R^2 = 0.52, MAE = 4.13</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bloom_doy <span class="sc">~</span> year, dat_Wash, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Full Bloom Day of the Year"</span>, <span class="at">bty =</span> <span class="st">"L"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Year"</span>, <span class="at">main =</span> <span class="st">"Best Predictor for Washington, D.C.: Year"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>mYearW <span class="ot">&lt;-</span> <span class="fu">lm</span>(bloom_doy <span class="sc">~</span> year, <span class="at">data =</span> dat_Wash)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mYearW)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Predict Bloom Date 2024</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data24_Wash <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="dv">2024</span>, <span class="at">DRD =</span> DRD24_Wash, <span class="at">t.pred =</span> tpred24_Wash, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mean.jan =</span> j24_Wash)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mAllW, <span class="at">newdata =</span> data24_Wash) <span class="co"># 85.86</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
85.85945 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doy_to_date</span>(<span class="dv">2024</span>, <span class="dv">86</span>) <span class="co"># I rounded it up to 86 since 85.86 is pretty late on March 25th. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-26"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I will compare this multiple regression approach to a random forest model: </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>rf_Wash_1 <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">+</span> t.pred <span class="sc">+</span> mean.jan,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat_Wash, </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"cforest"</span>, </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">.mtry =</span> <span class="dv">2</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"oob"</span>))</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>rf_Wash_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional Inference Random Forest 

66 samples
 4 predictor

No pre-processing
Resampling results:

  RMSE      Rsquared  MAE     
  5.784858  0.341967  4.686431

Tuning parameter 'mtry' was held constant at a value of 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OOB RMSR = 5.78 -&gt; this is higher than the multiple regression model. </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(rf_Wash_1, <span class="at">newdata =</span> data24_Wash) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.outcome 
89.24244 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doy_to_date</span>(<span class="dv">2024</span>, <span class="dv">89</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-29"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random forest prediction would be March 29th. However, I will stick to the </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># regression prediction, since it has better fit indices. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span style="color: red;">My prediction for Washington is March 25th 2024</span></p>
</section>
<section id="liestal-1" class="level3">
<h3 class="anchored" data-anchor-id="liestal-1">2. Liestal</h3>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>cherry_lies <span class="ot">&lt;-</span> <span class="fu">subset</span>(cherry, location <span class="sc">==</span> <span class="st">"liestal"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># now use data from temperature data set: temp_Lies</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>dat_lies <span class="ot">&lt;-</span> <span class="fu">merge</span>(cherry_lies, temp_Lies, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>mYearL <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year, <span class="at">data =</span> dat_lies, </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mYearL) # R^2 = 0.22</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>mDRDL <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> DRD, <span class="at">data =</span> dat_lies, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mDRDL) # R^2 = 0.34</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>mtpredL <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> t.pred, <span class="at">data =</span> dat_lies, </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mtpredL) # R^2 = 0.57</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>mjanL <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> mean.jan, <span class="at">data =</span> dat_lies, </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mjanL) # R^2 = 0.08</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>mAllL <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">+</span> t.pred <span class="sc">+</span> mean.jan, <span class="at">data =</span> dat_lies,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mAllL) # R^2 = 0.72</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>mAllL2 <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">*</span> t.pred <span class="sc">+</span> mean.jan, <span class="at">data =</span> dat_lies, </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mAllL2) <span class="co"># R^2 = 0.73 -&gt; I will take this model. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-18.3303  -4.2909   0.5589   3.5102  18.0839 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  342.90449   90.28503   3.798 0.000339 ***
year          -0.12232    0.04597  -2.661 0.009946 ** 
DRD            1.26673    0.58305   2.173 0.033707 *  
t.pred        -3.28782    1.65645  -1.985 0.051662 .  
mean.jan       1.71900    0.42677   4.028 0.000158 ***
`DRD:t.pred`  -0.12579    0.09684  -1.299 0.198834    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.411 on 61 degrees of freedom
Multiple R-squared:  0.7289,    Adjusted R-squared:  0.7067 
F-statistic: 32.81 on 5 and 61 DF,  p-value: 4.36e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check cross validation results (using leave-one-out method): </span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>mAllL2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

67 samples
 4 predictor

No pre-processing
Resampling: Leave-One-Out Cross-Validation 
Summary of sample sizes: 66, 66, 66, 66, 66, 66, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  6.823537  0.6653337  5.274706

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 6.82, R^2 = 0.67, MAE = 5.27</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For Liestal, the modeled temperature at DRD is the best single predictor: </span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>rbPal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">'cadetblue2'</span>,<span class="st">'maroon3'</span>))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>dat_lies<span class="sc">$</span>Col <span class="ot">&lt;-</span> <span class="fu">rbPal</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(<span class="fu">cut</span>(dat_lies<span class="sc">$</span>year,<span class="at">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bloom_doy <span class="sc">~</span> t.pred, dat_lies, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Full Bloom Day of the Year"</span>, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"ModeledTemperature at Dormancy Release Date"</span>, </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Best Predictor for Liestal: DRD Temperature"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty =</span> <span class="st">"L"</span>, <span class="at">col =</span> dat_lies<span class="sc">$</span>Col)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(dat_lies, <span class="fu">text</span>((bloom_doy <span class="sc">-</span><span class="fl">1.75</span>) <span class="sc">~</span> t.pred, <span class="at">labels =</span> year, <span class="at">cex =</span> <span class="fl">0.58</span>, <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(dat_lies<span class="sc">$</span>Col, <span class="at">alpha =</span> <span class="fl">0.9</span>)))</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>mtpredL <span class="ot">&lt;-</span> <span class="fu">lm</span>(bloom_doy <span class="sc">~</span> t.pred, <span class="at">data =</span> dat_lies)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mtpredL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Predict Bloom Date 2023</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>data24_Lies <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="dv">2024</span>, <span class="at">DRD =</span> DRD24_Lies, <span class="at">t.pred =</span> tpred24_Lies, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mean.jan =</span> j24_Lies)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mAllL2, <span class="at">newdata =</span> data24_Lies) <span class="co"># 91.40</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
91.39672 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doy_to_date</span>(<span class="dv">2024</span>, <span class="dv">91</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-31"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random forest method: </span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>rf_Lies_1 <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">+</span> t.pred <span class="sc">+</span> mean.jan,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat_lies, </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"cforest"</span>, </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">.mtry =</span> <span class="dv">2</span>),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"oob"</span>))</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>rf_Lies_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional Inference Random Forest 

67 samples
 4 predictor

No pre-processing
Resampling results:

  RMSE     Rsquared   MAE    
  7.43566  0.6186756  5.76511

Tuning parameter 'mtry' was held constant at a value of 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 7.43, R^2 = 0.61, MAE = 5.67 -&gt; Again, the regression approach gives the </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># better results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span style="color: red;">My prediction for Liestal is March 31st 2024</span></p>
</section>
<section id="kyoto-1" class="level3">
<h3 class="anchored" data-anchor-id="kyoto-1">3. Kyoto</h3>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>cherry_kyot <span class="ot">&lt;-</span> <span class="fu">subset</span>(cherry, location <span class="sc">==</span> <span class="st">"kyoto"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># now use data from temperature data set: temp_kyot</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>dat_kyot <span class="ot">&lt;-</span> <span class="fu">merge</span>(cherry_kyot, temp_Kyot, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>mYearK <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year, <span class="at">data =</span> dat_kyot, </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mYearK) # R^2 = 0.24</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>mDRDK <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> DRD, <span class="at">data =</span> dat_kyot, </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mDRDK) # R^2 = 0.40</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>mtpredK <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> t.pred, <span class="at">data =</span> dat_kyot, </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mtpredK) # R^2 = 0.33</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>mjanK <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> mean.jan, <span class="at">data =</span> dat_kyot, </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mjanK) # R^2 = 0.05</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>mAllK <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">+</span> t.pred <span class="sc">+</span> mean.jan, <span class="at">data =</span> dat_kyot, </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mAllK) # R^2 = 0.76</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>mAllK2 <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">*</span> t.pred <span class="sc">+</span> mean.jan, <span class="at">data =</span> dat_kyot, </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mAllK2) <span class="co"># R^2 = 0.78-&gt; I will take this model. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
   Min     1Q Median     3Q    Max 
-5.975 -1.716 -0.111  1.573  6.235 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  168.49585   40.80485   4.129 0.000111 ***
year          -0.07749    0.01492  -5.194 2.43e-06 ***
DRD            4.19033    1.29115   3.245 0.001893 ** 
t.pred         5.02142    3.27446   1.534 0.130237    
mean.jan       1.44701    0.38591   3.750 0.000392 ***
`DRD:t.pred`  -0.34390    0.13219  -2.601 0.011593 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.353 on 62 degrees of freedom
Multiple R-squared:  0.7847,    Adjusted R-squared:  0.7673 
F-statistic: 45.18 on 5 and 62 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check cross validation results (using leave-one-out method): </span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>mAllK2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

68 samples
 4 predictor

No pre-processing
Resampling: Leave-One-Out Cross-Validation 
Summary of sample sizes: 67, 67, 67, 67, 67, 67, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  2.463822  0.7414536  1.987877

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 2.46, R^2 = 0.74, MAE = 1.99</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>rbPal <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">'cadetblue2'</span>,<span class="st">'maroon3'</span>))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>dat_kyot<span class="sc">$</span>Col <span class="ot">&lt;-</span> <span class="fu">rbPal</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(<span class="fu">cut</span>(dat_kyot<span class="sc">$</span>year,<span class="at">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bloom_doy <span class="sc">~</span> DRD, dat_kyot, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Full Bloom Day of the Year"</span>, <span class="at">main =</span> <span class="st">"Best Predictor for Kyoto: DRD"</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Dormacy Release Date"</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> dat_kyot<span class="sc">$</span>Col)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">bty =</span> <span class="st">"L"</span>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(dat_kyot, <span class="fu">text</span>((bloom_doy <span class="sc">-</span><span class="dv">1</span>) <span class="sc">~</span> DRD, <span class="at">labels =</span> year, <span class="at">cex =</span> <span class="fl">0.58</span>, </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(dat_kyot<span class="sc">$</span>Col, <span class="at">alpha =</span> <span class="fl">0.8</span>)))</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>mDRDK <span class="ot">&lt;-</span> <span class="fu">lm</span>(bloom_doy <span class="sc">~</span> DRD, <span class="at">data =</span> dat_kyot)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mDRDK)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check prediction accuracy: </span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>pbloomK <span class="ot">&lt;-</span> <span class="fu">predict</span>(mAllK2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">year =</span> dat_kyot<span class="sc">$</span>year, </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">DRD =</span> dat_kyot<span class="sc">$</span>DRD, <span class="at">t.pred =</span> dat_kyot<span class="sc">$</span>t.pred, <span class="at">mean.jan =</span> dat_kyot<span class="sc">$</span>t.pred))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(dat_kyot<span class="sc">$</span>bloom_doy, pbloomK) <span class="co"># 2.83</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.826971</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mae</span>(dat_kyot<span class="sc">$</span>bloom_doy, pbloomK) <span class="co"># 2.28</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.283398</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(dat_kyot<span class="sc">$</span>bloom_doy, pbloomK) <span class="co"># 0.86</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8562401</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Predict Bloom Date 2024</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>data24_Kyot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="dv">2024</span>, <span class="at">DRD =</span> DRD24_Kyot, <span class="at">t.pred =</span> tpred24_Kyot, </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mean.jan =</span> j24_Kyot)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mAllK2, <span class="at">newdata =</span> data24_Kyot) <span class="co"># 93.20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
93.20421 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doy_to_date</span>(<span class="dv">2024</span>, <span class="dv">93</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-04-02"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>rf_Kyot_1 <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">+</span> t.pred <span class="sc">+</span> mean.jan,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat_kyot, </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"cforest"</span>, </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">.mtry =</span> <span class="dv">2</span>),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"oob"</span>))</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>rf_Kyot_1 <span class="co"># RMSE = 3.21, R  2 = 0.63, MAE = 2.32 -&gt; Again, regression is better. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Conditional Inference Random Forest 

68 samples
 4 predictor

No pre-processing
Resampling results:

  RMSE      Rsquared   MAE     
  3.190549  0.6339552  2.313274

Tuning parameter 'mtry' was held constant at a value of 2</code></pre>
</div>
</div>
<p><span style="color: red;"> My prediction for Kyoto is April 2nd 2024. </span></p>
</section>
</section>
</section>
<section id="step-2-predict-2024-vancouver-and-new-york-city-bloom-dates" class="level1">
<h1>Step 2: Predict 2024 Vancouver and New York City Bloom Dates</h1>
<p>For Vancouver and New York City, we do not have a lot of historic bloom dates. I therefore try to predict these dates from the USA NPN dataset. To evaluate how good this works, I first do the same for Washington and compare the predicted with the actual dates.</p>
<section id="to-estimate-model-fit-model-historic-bloom-dates-in-washington-d.c." class="level2">
<h2 class="anchored" data-anchor-id="to-estimate-model-fit-model-historic-bloom-dates-in-washington-d.c.">To estimate model fit: Model historic bloom dates in Washington, D.C.</h2>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/USA-NPN_individual_phenometrics_data.csv"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>year <span class="ot">&lt;-</span> dat<span class="sc">$</span>First_Yes_Year</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>Species <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dat<span class="sc">$</span>Species)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>m_wash <span class="ot">&lt;-</span> <span class="fu">train</span>(First_Yes_DOY <span class="sc">~</span> year <span class="sc">+</span> Latitude <span class="sc">+</span> Longitude <span class="sc">+</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>               Elevation_in_Meters <span class="sc">+</span> Species <span class="sc">+</span> Tmax_Winter, <span class="at">data =</span> dat, </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>w_wash <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Washington"</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>w_wash <span class="ot">&lt;-</span> <span class="fu">subset</span>(w_wash, <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>tmaxWinter_wash <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(tmax <span class="sc">~</span> yearWinter, w_wash, mean)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>tmaxWinter_wash<span class="sc">$</span>tmax <span class="ot">&lt;-</span> tmaxWinter_wash<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>data_wash <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">unique</span>(dat<span class="sc">$</span>year), <span class="at">Latitude =</span> <span class="fl">38.8853</span>, </span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Longitude =</span> <span class="sc">-</span><span class="fl">77.0386</span>, <span class="at">Elevation_in_Meters =</span> <span class="dv">0</span>, </span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Species =</span> <span class="st">"yedoensis"</span>, </span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Tmax_Winter =</span> tmaxWinter_wash[<span class="dv">60</span><span class="sc">:</span><span class="dv">74</span>, ]<span class="sc">$</span>tmax)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>doy.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m_wash, <span class="at">newdata =</span> data_wash)</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>doy.actual <span class="ot">&lt;-</span> <span class="fu">subset</span>(cherry, year <span class="sc">%in%</span> <span class="fu">unique</span>(dat<span class="sc">$</span>year) <span class="sc">&amp;</span> location <span class="sc">==</span> <span class="st">"washingtondc"</span>)<span class="sc">$</span>bloom_doy</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>doy <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">doy.pred =</span> doy.pred, <span class="at">doy.actual =</span> doy.actual, </span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">year =</span> <span class="fu">unique</span>(dat<span class="sc">$</span>year))</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(doy.pred, doy.actual) <span class="co"># 0.40</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3954145</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(doy.pred, doy.actual) <span class="co"># 8.36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.357482</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mae</span>(doy.pred, doy.actual) <span class="co"># 7.36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.356402</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(doy.pred <span class="sc">~</span> year, doy, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">100</span>), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">ylab =</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Bloom DOY (modeled / actual)"</span>, <span class="at">xlab =</span> <span class="st">"Year"</span>, <span class="at">bty =</span> <span class="st">"L"</span>, </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Modeled vs. actual bloom dates: Wahsington, D.C."</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(doy.actual <span class="sc">~</span> year, doy, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="at">x0 =</span> doy<span class="sc">$</span>year, <span class="at">x1 =</span> doy<span class="sc">$</span>year, <span class="at">y0 =</span> doy<span class="sc">$</span>doy.pred, <span class="at">y1 =</span> doy<span class="sc">$</span>doy.actual, </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">length =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="st">"dashed"</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(doy.pred <span class="sc">~</span> year, doy, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"predicted"</span>, <span class="st">"actual"</span>), <span class="at">title =</span> <span class="st">"Washington D.C. Bloom DOY"</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>rf_old_Wash <span class="ot">&lt;-</span> <span class="fu">train</span>(First_Yes_DOY <span class="sc">~</span> year <span class="sc">+</span> Latitude <span class="sc">+</span> Longitude <span class="sc">+</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>               Elevation_in_Meters <span class="sc">+</span> Species <span class="sc">+</span> Tmax_Winter, </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dat, </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"cforest"</span>, </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">.mtry =</span> <span class="dv">5</span>),</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"oob"</span>))</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># again, regression performs better than random forest. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The predictions are on average wrong by 7 days which isn’t very good. However, I tried a few different things and nothing seemed to work better, so I will go with it. <br></p>
<p>I can now estimate the historic bloom dates in Vancouver from the available data.</p>
</section>
<section id="model-historic-bloom-dates-in-vancouver" class="level2">
<h2 class="anchored" data-anchor-id="model-historic-bloom-dates-in-vancouver">Model historic bloom dates in Vancouver</h2>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>m_vanc <span class="ot">&lt;-</span> <span class="fu">lm</span>(First_Yes_DOY <span class="sc">~</span> year <span class="sc">+</span> Latitude <span class="sc">+</span> Longitude <span class="sc">+</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>               Elevation_in_Meters <span class="sc">+</span> Species <span class="sc">+</span> Tmax_Winter, dat)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>w_vanc <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Vancouver"</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>w_vanc <span class="ot">&lt;-</span> <span class="fu">subset</span>(w_vanc, <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>tmaxWinter_vanc <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(tmax <span class="sc">~</span> yearWinter, w_vanc, mean)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>tmaxWinter_vanc<span class="sc">$</span>tmax <span class="ot">&lt;-</span> tmaxWinter_vanc<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>data_vanc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">unique</span>(dat<span class="sc">$</span>year), <span class="at">Latitude =</span> <span class="fl">49.2237</span>, </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Longitude =</span>  <span class="sc">-</span><span class="fl">123.1636</span>, <span class="at">Elevation_in_Meters =</span> <span class="dv">24</span>, </span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Species =</span> <span class="st">"yedoensis"</span>, </span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Tmax_Winter =</span> tmaxWinter_vanc[<span class="dv">35</span><span class="sc">:</span><span class="dv">49</span>, ]<span class="sc">$</span>tmax)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>doy.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m_vanc, <span class="at">newdata =</span> data_vanc)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>doy.pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
113.1107 112.4823 111.8566 111.2300 110.6037 109.9780 109.3497 108.7234 
       9       10       11       12       13       14       15 
108.0989 107.4716 106.8449 106.2179 105.5914 104.9657 104.3390 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>data_vanc<span class="sc">$</span>bloom_doy <span class="ot">&lt;-</span> doy.pred</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For the last two years, I do, in fact, have the true bloom dates. </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I thus change the last two doys to the actual ones. </span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>data_vanc[<span class="dv">14</span><span class="sc">:</span><span class="dv">15</span>, ]<span class="sc">$</span>bloom_doy <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">86</span>, <span class="dv">97</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With these modeled bloom dates, I can now estimate the 2024 bloom date like I did for the other locations. But first, I have to estimate the Vancouver DRDs and calculate the past mean temperatures for January.</p>
</section>
<section id="estimate-2024-drd-and-mean-january-temperature" class="level2">
<h2 class="anchored" data-anchor-id="estimate-2024-drd-and-mean-january-temperature">Estimate 2024 DRD and mean January temperature:</h2>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>Vanc_2024 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/vancouver 2023-10-01 to 2024-02-29.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether both data sources match: </span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>wGHCN <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"Vancouver"</span> <span class="sc">&amp;</span> </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                  date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>wVC <span class="ot">&lt;-</span> <span class="fu">subset</span>(Vanc_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tempmax</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(wGHCN, wVC, <span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="co"># correlation is very high -&gt; everything okay!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9629359</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>Vanc_2024<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">as.Date</span>(Vanc_2024<span class="sc">$</span>datetime))</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>Vanc_2024<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span><span class="dv">60</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>Vanc_2024<span class="sc">$</span>tmax <span class="ot">&lt;-</span> Vanc_2024<span class="sc">$</span>tempmax</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>mw_Vanc <span class="ot">&lt;-</span> <span class="fu">subset</span>(<span class="fu">aggregate</span>(tmax <span class="sc">~</span> doy, <span class="fu">subset</span>(weather_Vanc, year <span class="sc">&gt;=</span> <span class="dv">2013</span>), mean), </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                  doy <span class="sc">%in%</span> <span class="dv">61</span><span class="sc">:</span><span class="dv">152</span>)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>mw_Vanc<span class="sc">$</span>tmax <span class="ot">&lt;-</span> mw_Vanc<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>w24_Vanc <span class="ot">&lt;-</span> Vanc_2024[, <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)]</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mw_Vanc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>w_Vanc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(w24_Vanc, mw_Vanc)</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit quadratic regression with specified weights: </span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), <span class="fu">c</span>(<span class="dv">153</span>, <span class="dv">91</span>))</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>fit24_Vanc <span class="ot">&lt;-</span> <span class="fu">lm</span>(tmax <span class="sc">~</span> doy.n <span class="sc">+</span> <span class="fu">I</span>(doy.n<span class="sc">^</span><span class="dv">2</span>), w_Vanc, <span class="at">weights =</span> weights)</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>coefs24_Vanc <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit24_Vanc)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>doy.p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span> <span class="dv">153</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>fit.p_Vanc <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit24_Vanc, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">doy.n =</span> doy.p))</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>fun24_Vanc <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>  coefs24_Vanc[<span class="dv">1</span>] <span class="sc">+</span> coefs24_Vanc[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span> coefs24_Vanc[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>DRD24_Vanc <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Vanc, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>])</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>t.DRD24_Vanc <span class="ot">&lt;-</span> w_Vanc[w_Vanc<span class="sc">$</span>doy.n <span class="sc">==</span> <span class="fu">round</span>(DRD24_Vanc), ]<span class="sc">$</span>tmax</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>tpred24_Vanc <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_Vanc, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">2</span>])</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Vanc, doy.n <span class="sc">&lt;=</span> <span class="dv">60</span>), </span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot</span>(tmax <span class="sc">~</span> doy.n, <span class="at">ylab =</span> <span class="st">"Maximum Temperature (°Celsius)"</span>, </span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlab =</span> <span class="st">"Day of the Year"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, </span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="dv">150</span>), <span class="at">bty =</span> <span class="st">"L"</span>, </span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">main =</span> <span class="st">"Predicted 2023 DRD: Vancouver"</span>))</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_Vanc, doy.n <span class="sc">&gt;</span> <span class="dv">60</span>), </span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>     <span class="fu">points</span>(tmax <span class="sc">~</span> doy.n, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)))</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.p_Vanc <span class="sc">~</span> doy.p, <span class="at">col =</span> <span class="st">"forestgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> DRD24_Vanc, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(DRD24_Vanc,  <span class="dv">20</span>, <span class="st">"Dormacy Release Date"</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>DRD_Vanc <span class="ot">&lt;-</span> <span class="fu">c</span>(DRD_Vancouver, DRD24_Vanc) </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>t.pred_Vanc <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_Vanc<span class="sc">$</span>t.pred, tpred24_Vanc)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean January temperature</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>j24_Vanc <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(Vanc_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>) <span class="sc">&amp;</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-31"</span>))<span class="sc">$</span>tempmax) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predict-2024-bloom-date-in-vancouver" class="level2">
<h2 class="anchored" data-anchor-id="predict-2024-bloom-date-in-vancouver">Predict 2024 Bloom Date in Vancouver</h2>
<p>I now have all the data to predict the 2024 bloom date in Vancouver.</p>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>dat_Vanc <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_vanc, temp_Vanc, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Different Models</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>mYearV <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year, <span class="at">data =</span> dat_Vanc, </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mYearV) # R^2 = 0.61</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>mDRDV <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> DRD, <span class="at">data =</span> dat_Vanc, </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mDRDV) # R^2 = 0.01</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>mtpredV <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> t.pred, <span class="at">data =</span> dat_Vanc, </span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mtpredV) # R^2 = 0.08</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>mjanV <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> mean.jan, <span class="at">data =</span> dat_Vanc, </span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mjanV) # R^2 &lt; .01</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>mAllV <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">*</span> t.pred <span class="sc">+</span> mean.jan, <span class="at">data =</span> dat_Vanc, </span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mAllV) <span class="co"># R^2 = 0.63</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.9958  -1.2376   0.4798   2.6473   4.7052 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  2738.7915   779.9940   3.511  0.00661 **
year           -1.2962     0.3814  -3.398  0.00789 **
DRD            -1.2371     2.5400  -0.487  0.63787   
t.pred         -2.8939     5.8467  -0.495  0.63248   
mean.jan        0.5430     1.5139   0.359  0.72810   
`DRD:t.pred`    0.1582     0.3623   0.437  0.67263   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.327 on 9 degrees of freedom
Multiple R-squared:  0.6268,    Adjusted R-squared:  0.4194 
F-statistic: 3.023 on 5 and 9 DF,  p-value: 0.0712</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I will use the model with everything but year as predictors. </span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check prediction accuracy: </span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>mAllV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

15 samples
 4 predictor

No pre-processing
Resampling: Leave-One-Out Cross-Validation 
Summary of sample sizes: 14, 14, 14, 14, 14, 14, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  6.946136  0.2909384  5.019634

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 6.95, R^2 = 0.29, MAE = 5.02</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of course, this needs to be interpreted with caution, since the DV (past blooom</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dates) are not the real ones. I am not sure why R^2 is so low, but the other</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># values seem okay. </span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Predict Bloom Date 2024</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>data24_Vanc <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="dv">2024</span>, <span class="at">DRD =</span> DRD24_Vanc, <span class="at">t.pred =</span> tpred24_Vanc, </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mean.jan =</span> j24_Vanc)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mYearV, <span class="at">newdata =</span> data24_Vanc) <span class="co"># 97.24</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
97.23967 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doy_to_date</span>(<span class="dv">2024</span>, <span class="dv">97</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-04-06"</code></pre>
</div>
</div>
<p><span style="color: red;"> My prediction for Vancouver is April 6th, 2024. </span></p>
</section>
<section id="model-historic-bloom-dates-in-new-york-city" class="level2">
<h2 class="anchored" data-anchor-id="model-historic-bloom-dates-in-new-york-city">Model historic bloom dates in New York City</h2>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>m_ny <span class="ot">&lt;-</span> <span class="fu">lm</span>(First_Yes_DOY <span class="sc">~</span> year <span class="sc">+</span> Latitude <span class="sc">+</span> Longitude <span class="sc">+</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>               Elevation_in_Meters <span class="sc">+</span> Species <span class="sc">+</span> Tmax_Winter, dat)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>w_ny <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"NewYork"</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>w_ny <span class="ot">&lt;-</span> <span class="fu">subset</span>(w_ny, <span class="fu">month</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>tmaxWinter_ny <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(tmax <span class="sc">~</span> yearWinter, w_ny, mean)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>tmaxWinter_ny<span class="sc">$</span>tmax <span class="ot">&lt;-</span> tmaxWinter_ny<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>data_ny <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">unique</span>(dat<span class="sc">$</span>year), <span class="at">Latitude =</span> <span class="fl">40.73040</span>, </span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Longitude =</span>  <span class="sc">-</span><span class="fl">73.99809</span>, <span class="at">Elevation_in_Meters =</span> <span class="fl">8.5</span>, </span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Species =</span> <span class="st">"yedoensis"</span>, </span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Tmax_Winter =</span> tmaxWinter_ny[<span class="dv">35</span><span class="sc">:</span><span class="dv">49</span>, ]<span class="sc">$</span>tmax)</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>doy.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m_ny, <span class="at">newdata =</span> data_ny)</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>doy.pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6         7         8 
102.64284 102.01767 101.39106 100.76176 100.13646  99.50985  98.88219  98.25755 
        9        10        11        12        13        14        15 
 97.63052  97.00433  96.37551  95.75077  95.12393  94.49763  93.87138 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>data_ny<span class="sc">$</span>bloom_doy <span class="ot">&lt;-</span> doy.pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With these modeled bloom dates, I can now estimate the 2024 bloom date like I did for the other locations. But first, I have to estimate the New York City DRDs and calculate the past mean temperatures for January.</p>
</section>
<section id="estimate-2023-drd-and-mean-january-temperature" class="level2">
<h2 class="anchored" data-anchor-id="estimate-2023-drd-and-mean-january-temperature">Estimate 2023 DRD and mean January temperature:</h2>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>NY_2024 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"peak-bloom-prediction/data/new york city 2023-10-01 to 2024-02-29.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check whether both data sources match: </span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>wGHCN <span class="ot">&lt;-</span> <span class="fu">subset</span>(weather, location <span class="sc">==</span> <span class="st">"NewYork"</span> <span class="sc">&amp;</span> </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>                  date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;=</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>wVC <span class="ot">&lt;-</span> <span class="fu">subset</span>(NY_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-01"</span>) <span class="sc">&amp;</span> <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-10-31"</span>))<span class="sc">$</span>tempmax</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(wGHCN, wVC, <span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="co"># correlation is very high -&gt; everything okay!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9814348</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>NY_2024<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">yday</span>(<span class="fu">as.Date</span>(NY_2024<span class="sc">$</span>datetime))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>NY_2024<span class="sc">$</span>doy.n <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span><span class="dv">60</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>NY_2024<span class="sc">$</span>tmax <span class="ot">&lt;-</span> NY_2024<span class="sc">$</span>tempmax</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>mw_NY <span class="ot">&lt;-</span> <span class="fu">subset</span>(<span class="fu">aggregate</span>(tmax <span class="sc">~</span> doy, <span class="fu">subset</span>(weather_NY, year <span class="sc">&gt;=</span> <span class="dv">2013</span>), mean), </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>                  doy <span class="sc">%in%</span> <span class="dv">61</span><span class="sc">:</span><span class="dv">152</span>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>mw_NY<span class="sc">$</span>tmax <span class="ot">&lt;-</span> mw_NY<span class="sc">$</span>tmax <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>w24_NY <span class="ot">&lt;-</span> NY_2024[, <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)]</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mw_NY) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"doy.n"</span>, <span class="st">"tmax"</span>)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>w_NY <span class="ot">&lt;-</span> <span class="fu">rbind</span>(w24_NY, mw_NY)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit quadratic regression with specified weights: </span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.2</span>), <span class="fu">c</span>(<span class="dv">153</span>, <span class="dv">91</span>))</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>fit24_NY <span class="ot">&lt;-</span> <span class="fu">lm</span>(tmax <span class="sc">~</span> doy.n <span class="sc">+</span> <span class="fu">I</span>(doy.n<span class="sc">^</span><span class="dv">2</span>), w_NY, <span class="at">weights =</span> weights)</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>coefs24_NY <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit24_NY)</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>doy.p <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">91</span><span class="sc">:</span> <span class="dv">153</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>fit.p_NY <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit24_NY, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">doy.n =</span> doy.p))</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>fun24_NY <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  coefs24_NY[<span class="dv">1</span>] <span class="sc">+</span> coefs24_NY[<span class="dv">2</span>]<span class="sc">*</span>x <span class="sc">+</span> coefs24_NY[<span class="dv">3</span>]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>DRD24_NY <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_NY, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>])</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>t.DRD24_NY <span class="ot">&lt;-</span> w_NY[w_NY<span class="sc">$</span>doy.n <span class="sc">==</span> <span class="fu">round</span>(DRD24_NY), ]<span class="sc">$</span>tmax</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>tpred24_NY <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">optimize</span>(fun24_NY, <span class="at">interval =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">365</span>), </span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">maximum =</span> <span class="cn">FALSE</span>)[<span class="dv">2</span>])</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_NY, doy.n <span class="sc">&lt;=</span> <span class="dv">60</span>), </span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>     <span class="fu">plot</span>(tmax <span class="sc">~</span> doy.n, <span class="at">ylab =</span> <span class="st">"Maximum Temperature (°Celsius)"</span>, </span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlab =</span> <span class="st">"Day of the Year"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.8</span>, </span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">91</span>, <span class="dv">150</span>), <span class="at">bty =</span> <span class="st">"L"</span>, </span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">main =</span> <span class="st">"Predicted 2023 DRD: New York City"</span>))</span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">subset</span>(w_NY, doy.n <span class="sc">&gt;</span> <span class="dv">60</span>), </span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>     <span class="fu">points</span>(tmax <span class="sc">~</span> doy.n, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)))</span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit.p_NY <span class="sc">~</span> doy.p, <span class="at">col =</span> <span class="st">"forestgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> DRD24_NY, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(DRD24_NY,  <span class="dv">20</span>, <span class="st">"Dormacy Release Date"</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Cherry_Blossom_24_RF_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>DRD_NY <span class="ot">&lt;-</span> <span class="fu">c</span>(DRD_NewYork, DRD24_NY) </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>t.pred_NY <span class="ot">&lt;-</span> <span class="fu">c</span>(temp_NY<span class="sc">$</span>t.pred, tpred24_NY)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean January temperature</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>j24_NY <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">subset</span>(NY_2024, <span class="fu">as.Date</span>(datetime) <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-01"</span>) <span class="sc">&amp;</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as.Date</span>(datetime) <span class="sc">&lt;=</span> <span class="fu">as.Date</span>(<span class="st">"2024-01-31"</span>))<span class="sc">$</span>tempmax) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I now have all the data to predict the 2024 bloom date in New York City</p>
<div class="cell" data-figure.align="center" data-figure.height="10" data-figure.width="10">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>dat_NY <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_ny, temp_NY, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Different Models</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>mYearN <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year, <span class="at">data =</span> dat_NY, </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mYearV) # R^2 = 0.61</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>mDRDN <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> DRD, <span class="at">data =</span> dat_NY, </span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mDRDV) # R^2 = 0.11</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>mtpredN <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> t.pred, <span class="at">data =</span> dat_NY, </span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mtpredV) # R^2 = 0.13</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>mjanN <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> mean.jan, <span class="at">data =</span> dat_NY, </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(mjanV) # R^2 = 0.27</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>mAllN <span class="ot">&lt;-</span> <span class="fu">train</span>(bloom_doy <span class="sc">~</span> year <span class="sc">+</span> DRD <span class="sc">*</span> t.pred <span class="sc">+</span> mean.jan, <span class="at">data =</span> dat_NY, </span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> tc)</span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mAllV) <span class="co"># R^2 = 0.63</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.9958  -1.2376   0.4798   2.6473   4.7052 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)  2738.7915   779.9940   3.511  0.00661 **
year           -1.2962     0.3814  -3.398  0.00789 **
DRD            -1.2371     2.5400  -0.487  0.63787   
t.pred         -2.8939     5.8467  -0.495  0.63248   
mean.jan        0.5430     1.5139   0.359  0.72810   
`DRD:t.pred`    0.1582     0.3623   0.437  0.67263   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.327 on 9 degrees of freedom
Multiple R-squared:  0.6268,    Adjusted R-squared:  0.4194 
F-statistic: 3.023 on 5 and 9 DF,  p-value: 0.0712</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I will use the model with everything but year as predictors. </span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check prediction accuracy: </span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>mAllV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

15 samples
 4 predictor

No pre-processing
Resampling: Leave-One-Out Cross-Validation 
Summary of sample sizes: 14, 14, 14, 14, 14, 14, ... 
Resampling results:

  RMSE      Rsquared   MAE     
  6.946136  0.2909384  5.019634

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 6.95, R^2 = 0.29, MAE = 5.02</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="co"># of course, this needs to be interpreted with caution, since the DV (past blooom</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dates) are not the real ones. </span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="do">### Predict Bloom Date 2024</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>data24_NY <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="dv">2024</span>, <span class="at">DRD =</span> DRD24_NY, <span class="at">t.pred =</span> tpred24_NY, </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mean.jan =</span> j24_NY)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mYearN, <span class="at">newdata =</span> data24_NY) <span class="co"># 93.24</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
93.24417 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doy_to_date</span>(<span class="dv">2024</span>, <span class="dv">93</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-04-02"</code></pre>
</div>
</div>
<p><span style="color: red;"> My prediction for New York City is April 2nd, 2024. </span></p>
<p>I know that this is probably too late for New York City (news articles on cherry blossom in NY say it is in March rather than April). However, without any past dates, I don’t know how to improve my prediction.</p>
</section>
</section>
<section id="last-step-produce-csv-document-of-results" class="level1">
<h1>Last Step: Produce csv-document of results</h1>
<p>I now put all predictions into one csv document:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"washingtondc"</span>, <span class="st">"liestal"</span>, <span class="st">"kyoto"</span>, <span class="st">"vancouver"</span>, <span class="st">"newyorkcity"</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">93</span>, <span class="dv">97</span>, <span class="dv">93</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>prediction_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">location =</span> location, <span class="at">prediction =</span> prediction)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(prediction_df, <span class="at">file =</span> <span class="st">"CherryBlossom.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>